# ISBM v2 Adaptor (REST)

[![Build Status](https://app.travis-ci.com/assetricity/isbm2_adaptor_rest.svg?branch=main)](https://app.travis-ci.com/assetricity/isbm2_adaptor_rest)
[![Coverage Status](https://coveralls.io/repos/github/assetricity/isbm2_adaptor_rest/badge.svg?branch=main)](https://coveralls.io/github/assetricity/isbm2_adaptor_rest?branch=main)
[![Code Climate](https://codeclimate.com/github/assetricity/isbm2_adaptor_rest.svg)](https://codeclimate.com/github/assetricity/isbm2_adaptor_rest)

ISBM v2 Adaptor (REST) provides a Ruby client API for the 
[OpenO&M ISBM v2 specification REST interface](https://www.openoandm.org/isbm).

It has been generated from the OpenAPI spec of the API using openapi-generator
and subsequently tailored and given a common, higher-level API to support 
interchangeability with the alternative interface types.

### OpenAPI generation details

An OpenAPI specification for the ISBM 2.0 RESTful interface.

This SDK is automatically generated by the [OpenAPI Generator](https://openapi-generator.tech) project:

- API version: 2.0
- Package version: 2.0.0
- Build package: org.openapitools.codegen.languages.RubyClientCodegen
For more information, please visit [http://www.mimosa.org/](http://www.mimosa.org/)

## Installation

### Bundler

Add the isbm2_adaptor_rest to your Gemfile:

```ruby
gem 'isbm2_adaptor_rest'
```

This gem uses a three part version, with the first two parts following the
OpenO&M ISBM specification and last part specifying a patch number. To use
the pessimistic version constraint, you will want to include the three part
version in your Gemfile:

```ruby
gem 'isbm2_adaptor_rest', '~> 2.0.0'
```

#### Optional Dependencies

If you wish to use the simple Notification Service provided in this gem, you will need to ensure
the following additional gems are installed, included in your Gemfile:

- 'rack', '~> 2.0', '>= 2.0.6'
- 'rack-contrib', '~> 2.1', '>= 2.1.0'

### Other

The gem can also be installed via the gem install command:

```shell
gem install isbm2_adaptor_rest
```

### Build a gem

To build the Ruby code into a gem:

```shell
gem build isbm2_adaptor_rest.gemspec
```

Then either install the gem locally:

```shell
gem install ./isbm2_adaptor_rest-2.0.0.gem
```

(for development, run `gem install --dev ./isbm2_adaptor_rest-2.0.0.gem` to install the development dependencies)

or publish the gem to a gem hosting service, e.g. [RubyGems](https://rubygems.org/).

Finally add this to the Gemfile:

    gem 'isbm2_adaptor_rest', '~> 2.0.0'

### Install from Git

If the Ruby gem is hosted at a git repository: https://github.com/assetricity/isbm2_adaptor_rest, then add the following in the Gemfile:

    gem 'isbm2_adaptor_rest', :git => 'https://github.com/assetricity/isbm2_adaptor_rest'

### Include the Ruby code directly

Include the Ruby code directly using `-I` as follows:

```shell
ruby -Ilib script.rb
```

## Getting Started

Please follow the [installation](#installation) procedure and then run the following code:

TODO: Update the following examples and usage to be more useful. The following was auto-generate 
and so is an arbitrarily selected endpoint operation. Examples can currently be found in the 'app'
subdirectory.

```ruby
# Load the gem
require 'isbm2_adaptor_rest'

# Setup authorization
IsbmRestAdaptor.configure do |config|
  # Configure HTTP basic authorization: username_password
  config.username = 'YOUR_USERNAME'
  config.password = 'YOUR_PASSWORD'
end

api_instance = IsbmRestAdaptor::ChannelManagementApi.new
channel_uri = 'channel_uri_example' # String | The identifier of the channel to be accessed (retrieved, deleted, modified, etc.)
opts = {
  security_tokens: [{"username":"user001","password":"password001"},{"username":"someOtherUser","password":"theirPassword"}] # Array<SecurityToken|UsernameToken|Hash> | The SecurityTokens to add.
}

begin
  #Adds security tokens to a channel.
  api_instance.add_security_tokens(channel_uri, opts)
rescue IsbmRestAdaptor::ApiError => e
  puts "Exception when calling ChannelManagementApi->add_security_tokens: #{e}"
end

```

## Development

The base of the ISBM v2 client adaptor is generated from the official
OpenO&M OpenAPI specification of the interface definitions. When a new
version of the schemas are released, generally, the client will be
regenerated from the new version of the schemas and the changes reviewed.

> Note: the generation process will wipe out some customisations that need
to be reinstated. Most customisation are marked as such, but care should
still be taken when reviewing code changes post-regeneration.

To regenerate the base code consistently, run the file:

```shell
script/generate_ruby_client.sh
```

The settings are in the file `script/ruby_client_conf.json`, of which only
the version will generally require modification.

Running the script will generate the main client for the main ISBM services
plus a client for the Notification service. The latter is generated only for
the notification specific model classes, the client API itself is not 
required.

The files will be generated to: `<PROJECT_ROOT>/tmp/client` and 
`<PROJECT_ROOT>/tmp/notification` for the main client and notification classes,
respectively.

## Documentation for API Endpoints

All URIs are relative to *http://localhost:80*

Class | Method | HTTP request | Description
------------ | ------------- | ------------- | -------------
*IsbmRestAdaptor::ChannelManagementApi* | [**add_security_tokens**](docs/ChannelManagementApi.md#add_security_tokens) | **POST** /channels/{channel-uri}/security-tokens | Adds security tokens to a channel.
*IsbmRestAdaptor::ChannelManagementApi* | [**create_channel**](docs/ChannelManagementApi.md#create_channel) | **POST** /channels | Create a new channel with the specified URI path fragment.
*IsbmRestAdaptor::ChannelManagementApi* | [**delete_channel**](docs/ChannelManagementApi.md#delete_channel) | **DELETE** /channels/{channel-uri} | Delete the Channel specified by 'channel-uri'
*IsbmRestAdaptor::ChannelManagementApi* | [**get_channel**](docs/ChannelManagementApi.md#get_channel) | **GET** /channels/{channel-uri} | Retrieve the Channel identified by 'channel-uri'
*IsbmRestAdaptor::ChannelManagementApi* | [**get_channels**](docs/ChannelManagementApi.md#get_channels) | **GET** /channels | Retrieve all the channels, subject to security permissions.
*IsbmRestAdaptor::ChannelManagementApi* | [**remove_security_tokens**](docs/ChannelManagementApi.md#remove_security_tokens) | **DELETE** /channels/{channel-uri}/security-tokens | Removes security tokens from a channel.
*IsbmRestAdaptor::ConfigurationDiscoveryServiceApi* | [**get_security_details**](docs/ConfigurationDiscoveryServiceApi.md#get_security_details) | **GET** /configuration/security-details | Gets the detailed security related information of the ISBM service provider. The security details are exposed only if the connecting application provides a valid SecurityToken. Each application may be assigned a SecurityToken out-of-band by the service provider.
*IsbmRestAdaptor::ConfigurationDiscoveryServiceApi* | [**get_supported_operations**](docs/ConfigurationDiscoveryServiceApi.md#get_supported_operations) | **GET** /configuration/supported-operations | Gets information about the supported operations and features of the ISBM service provider. The purpose of this operation is to allow an application to be configured appropriately to communicate successfully with the service provider.
*IsbmRestAdaptor::ConsumerPublicationServiceApi* | [**close_session**](docs/ConsumerPublicationServiceApi.md#close_session) | **DELETE** /sessions/{session-id} | Closes a session.
*IsbmRestAdaptor::ConsumerPublicationServiceApi* | [**open_subscription_session**](docs/ConsumerPublicationServiceApi.md#open_subscription_session) | **POST** /channels/{channel-uri}/subscription-sessions | Opens a subscription session for a channel.
*IsbmRestAdaptor::ConsumerPublicationServiceApi* | [**read_publication**](docs/ConsumerPublicationServiceApi.md#read_publication) | **GET** /sessions/{session-id}/publication | Returns the first non-expired publication message or a previously read expired message that satisfies the session message filters.
*IsbmRestAdaptor::ConsumerPublicationServiceApi* | [**remove_publication**](docs/ConsumerPublicationServiceApi.md#remove_publication) | **DELETE** /sessions/{session-id}/publication | Removes the first, if any, publication message in the subscription queue.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**close_session**](docs/ConsumerRequestServiceApi.md#close_session) | **DELETE** /sessions/{session-id} | Closes a session.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**expire_request**](docs/ConsumerRequestServiceApi.md#expire_request) | **DELETE** /sessions/{session-id}/requests/{message-id} | Expires a posted request message.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**open_consumer_request_session**](docs/ConsumerRequestServiceApi.md#open_consumer_request_session) | **POST** /channels/{channel-uri}/consumer-request-sessions | Opens a consumer request session for a channel for posting requests and reading responses.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**post_request**](docs/ConsumerRequestServiceApi.md#post_request) | **POST** /sessions/{session-id}/requests | Posts a request message on a channel.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**read_response**](docs/ConsumerRequestServiceApi.md#read_response) | **GET** /sessions/{session-id}/requests/{request-id}/response | Returns the first response message, if any, in the session message queue associated with the request.
*IsbmRestAdaptor::ConsumerRequestServiceApi* | [**remove_response**](docs/ConsumerRequestServiceApi.md#remove_response) | **DELETE** /sessions/{session-id}/requests/{request-id}/response | Deletes the first response message, if any, in the session message queue associated with the request.
*IsbmRestAdaptor::MetadataApi* | [**get_metadata**](docs/MetadataApi.md#get_metadata) | **GET** /api | Get metadata from the root of the API
*IsbmRestAdaptor::ProviderPublicationServiceApi* | [**close_session**](docs/ProviderPublicationServiceApi.md#close_session) | **DELETE** /sessions/{session-id} | Closes a session.
*IsbmRestAdaptor::ProviderPublicationServiceApi* | [**expire_publication**](docs/ProviderPublicationServiceApi.md#expire_publication) | **DELETE** /sessions/{session-id}/publications/{message-id} | Expires a posted publication.
*IsbmRestAdaptor::ProviderPublicationServiceApi* | [**open_publication_session**](docs/ProviderPublicationServiceApi.md#open_publication_session) | **POST** /channels/{channel-uri}/publication-sessions | Opens a publication session for a channel.
*IsbmRestAdaptor::ProviderPublicationServiceApi* | [**post_publication**](docs/ProviderPublicationServiceApi.md#post_publication) | **POST** /sessions/{session-id}/publications | Posts a publication message on a channel.
*IsbmRestAdaptor::ProviderRequestServiceApi* | [**close_session**](docs/ProviderRequestServiceApi.md#close_session) | **DELETE** /sessions/{session-id} | Closes a session.
*IsbmRestAdaptor::ProviderRequestServiceApi* | [**open_provider_request_session**](docs/ProviderRequestServiceApi.md#open_provider_request_session) | **POST** /channels/{channel-uri}/provider-request-sessions | Opens a provider request session for a channel for reading requests and posting responses.
*IsbmRestAdaptor::ProviderRequestServiceApi* | [**post_response**](docs/ProviderRequestServiceApi.md#post_response) | **POST** /sessions/{session-id}/requests/{request-id}/responses | Posts a response message on a channel.
*IsbmRestAdaptor::ProviderRequestServiceApi* | [**read_request**](docs/ProviderRequestServiceApi.md#read_request) | **GET** /sessions/{session-id}/request | Returns the first non-expired request message or a previously read expired message that satisfies the session message filters.
*IsbmRestAdaptor::ProviderRequestServiceApi* | [**remove_request**](docs/ProviderRequestServiceApi.md#remove_request) | **DELETE** /sessions/{session-id}/request | Deletes the first request message, if any, in the session message queue.


## Documentation for Models

 - [IsbmRestAdaptor::AuthenticationScheme](docs/AuthenticationScheme.md)
 - [IsbmRestAdaptor::Channel](docs/Channel.md)
 - [IsbmRestAdaptor::ChannelFault](docs/ChannelFault.md)
 - [IsbmRestAdaptor::ChannelType](docs/ChannelType.md)
 - [IsbmRestAdaptor::ContentFilteringLanguage](docs/ContentFilteringLanguage.md)
 - [IsbmRestAdaptor::FilterExpression](docs/FilterExpression.md)
 - [IsbmRestAdaptor::FilterExpressionExpressionString](docs/FilterExpressionExpressionString.md)
 - [IsbmRestAdaptor::Message](docs/Message.md)
 - [IsbmRestAdaptor::MessageContent](docs/MessageContent.md)
 - [IsbmRestAdaptor::MessageType](docs/MessageType.md)
 - [IsbmRestAdaptor::Namespace](docs/Namespace.md)
 - [IsbmRestAdaptor::NamespaceFault](docs/NamespaceFault.md)
 - [IsbmRestAdaptor::OperationFault](docs/OperationFault.md)
 - [IsbmRestAdaptor::ParameterFault](docs/ParameterFault.md)
 - [IsbmRestAdaptor::SecurityDetails](docs/SecurityDetails.md)
 - [IsbmRestAdaptor::SecurityTokenFault](docs/SecurityTokenFault.md)
 - [IsbmRestAdaptor::Session](docs/Session.md)
 - [IsbmRestAdaptor::SessionFault](docs/SessionFault.md)
 - [IsbmRestAdaptor::SessionType](docs/SessionType.md)
 - [IsbmRestAdaptor::SupportedOperations](docs/SupportedOperations.md)
 - [IsbmRestAdaptor::SupportedOperationsSupportedAuthentications](docs/SupportedOperationsSupportedAuthentications.md)
 - [IsbmRestAdaptor::SupportedOperationsSupportedContentFilteringLanguages](docs/SupportedOperationsSupportedContentFilteringLanguages.md)
 - [IsbmRestAdaptor::TokenSchema](docs/TokenSchema.md)
 - [IsbmRestAdaptor::UsernameToken](docs/UsernameToken.md)


## Documentation for Authorization


### username_password

- **Type**: HTTP basic authentication

## License

Copyright (c) 2021 [Assetricity, LLC](http://assetricity.com) and Matt Selway

ISBM v2 Adaptor (REST) is released under the MIT License. See [LICENSE](./LICENSE) for details.
